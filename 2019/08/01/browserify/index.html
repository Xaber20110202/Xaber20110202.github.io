<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head><meta name="generator" content="Hexo 3.8.0">
  
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5">




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1">




  <meta name="keywords" content="前端工程化,browserify,">



  <link rel="alternate" href="/atom.xml" title="Xaber's Blog" type="application/atom+xml">



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1">


<meta name="description" content="大概介绍 浏览器端的前端打包工具 主要用于在浏览器中使用 npm 包，最终会转换为 commonJS (require) 类似方式，在浏览器使用 方便模块细分，每个模块自成，通过 require 引用其他模块 基于流 Stream 旧时代产物，尽管也能勉强处理 css（CSS bundlers），html（brfs），但是不太友好，且年久失修  阅读此篇，大概可以较好使用 browserify，以">
<meta name="keywords" content="前端工程化,browserify">
<meta property="og:type" content="article">
<meta property="og:title" content="browserify 中文文档与使用教程">
<meta property="og:url" content="http://xaber.co/2019/08/01/browserify/index.html">
<meta property="og:site_name" content="Xaber&#39;s Blog">
<meta property="og:description" content="大概介绍 浏览器端的前端打包工具 主要用于在浏览器中使用 npm 包，最终会转换为 commonJS (require) 类似方式，在浏览器使用 方便模块细分，每个模块自成，通过 require 引用其他模块 基于流 Stream 旧时代产物，尽管也能勉强处理 css（CSS bundlers），html（brfs），但是不太友好，且年久失修  阅读此篇，大概可以较好使用 browserify，以">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-09-10T07:47:22.478Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="browserify 中文文档与使用教程">
<meta name="twitter:description" content="大概介绍 浏览器端的前端打包工具 主要用于在浏览器中使用 npm 包，最终会转换为 commonJS (require) 类似方式，在浏览器使用 方便模块细分，每个模块自成，通过 require 引用其他模块 基于流 Stream 旧时代产物，尽管也能勉强处理 css（CSS bundlers），html（brfs），但是不太友好，且年久失修  阅读此篇，大概可以较好使用 browserify，以">


<script>
(function () {
    window.zhuge = window.zhuge || [];
    window.zhuge.methods = "_init debug identify track trackLink trackForm page".split(" ");
    window.zhuge.factory = function(b) {
        return function() {
            var a = Array.prototype.slice.call(arguments);
            a.unshift(b);
            window.zhuge.push(a);
            return window.zhuge
        }
    };
    for (var i = 0; i < window.zhuge.methods.length; i++) {
        var key = window.zhuge.methods[i];
        window.zhuge[key] = window.zhuge.factory(key)
    }
    window.zhuge.load = function(b, x) {
        if (!document.getElementById("zhuge-js")) {
            var a = document.createElement("script");
            var verDate = new Date();
            var verStr = verDate.getFullYear().toString()
                + verDate.getMonth().toString() + verDate.getDate().toString();

            a.type = "text/javascript";
            a.id = "zhuge-js";
            a.async = !0;
            a.src = (location.protocol == 'http:' ? "http://sdk.zhugeio.com/zhuge-lastest.min.js?v=" : 'https://zgsdk.zhugeio.com/zhuge-lastest.min.js?v=') + verStr;
            var c = document.getElementsByTagName("script")[0];
            c.parentNode.insertBefore(a, c);
            window.zhuge._init(b, x)
        }
    };
    
    // 开发模式调试
    
    window.zhuge.load('49fc6625ddcc4004aa98d05e876a70e0');
    
})();
</script>


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'hide'
  };
</script>

  <title> browserify 中文文档与使用教程 | Xaber's Blog </title>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47125735-1', 'auto');
  ga('send', 'pageview');
</script>




  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Xaber's Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br>
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br>
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br>
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br>
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br>
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              browserify 中文文档与使用教程
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2019-08-01T12:54:12+08:00" content="2019-08-01">
            2019-08-01
          </time>
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope="" itemtype="https://schema.org/Thing">
                <a href="/categories/前端工程化/" itemprop="url" rel="index">
                  <span itemprop="name">前端工程化</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2019/08/01/browserify/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/08/01/browserify/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><h2 id="大概介绍"><a href="#大概介绍" class="headerlink" title="大概介绍"></a>大概介绍</h2><ol>
<li><strong>浏览器端</strong>的前端<strong>打包</strong>工具</li>
<li>主要用于在浏览器中使用 npm 包，最终会转换为 commonJS (require) 类似方式，在浏览器使用</li>
<li>方便模块细分，每个模块自成，通过 <code>require</code> 引用其他模块</li>
<li>基于流 <code>Stream</code></li>
<li>旧时代产物，尽管也能勉强处理 css（<a href="https://github.com/browserify/awesome-browserify#css-bundlers" target="_blank" rel="noopener">CSS bundlers</a>），html（<a href="https://github.com/browserify/brfs" target="_blank" rel="noopener">brfs</a>），但是不太友好，且年久失修</li>
</ol>
<p>阅读此篇，大概可以较好使用 browserify，以及将其用在合适的地方</p>
<p>此外，文中带 <del>删除线</del> 的内容，因相对的内容过时，阅读意义不大，可简单跳过</p>
<a id="more"></a>
<h2 id="大概分析"><a href="#大概分析" class="headerlink" title="大概分析"></a>大概分析</h2><p>以 nums.js，demo.js，build 文件做大概分析</p>
<h4 id="nums-js"><a href="#nums-js" class="headerlink" title="nums.js"></a>nums.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uniq = <span class="built_in">require</span>(<span class="string">'uniq'</span>); <span class="comment">// uniq 为 npm 依赖包</span></span><br><span class="line"><span class="keyword">var</span> nums = [ <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span> ];</span><br><span class="line"><span class="built_in">module</span>.exports = nums</span><br></pre></td></tr></table></figure>
<h4 id="demo-js"><a href="#demo-js" class="headerlink" title="demo.js"></a>demo.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = <span class="built_in">require</span>(<span class="string">'./nums'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(nums)</span><br></pre></td></tr></table></figure>
<h4 id="build"><a href="#build" class="headerlink" title="build"></a>build</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browserify = <span class="built_in">require</span>(<span class="string">'browserify'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">browserify([<span class="string">'./src/demo'</span>])</span><br><span class="line">	.bundle()</span><br><span class="line">	.pipe(fs.createWriteStream(<span class="string">'./build/demo.js'</span>))</span><br></pre></td></tr></table></figure>
<h4 id="build-后文件"><a href="#build-后文件" class="headerlink" title="build 后文件"></a>build 后文件</h4><p>通过 <a href="https://github.com/browserify/detective" target="_blank" rel="noopener">detective</a> 进行依赖查找，后落地为以下文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params">e,n,t</span>)</span>&#123;<span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params">i,f</span>)</span>&#123;<span class="keyword">if</span>(!n[i])&#123;<span class="keyword">if</span>(!e[i])&#123;<span class="keyword">var</span> c=<span class="string">"function"</span>==<span class="keyword">typeof</span> <span class="built_in">require</span>&amp;&amp;<span class="built_in">require</span>;<span class="keyword">if</span>(!f&amp;&amp;c)<span class="keyword">return</span> c(i,!<span class="number">0</span>);<span class="keyword">if</span>(u)<span class="keyword">return</span> u(i,!<span class="number">0</span>);<span class="keyword">var</span> a=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Cannot find module '"</span>+i+<span class="string">"'"</span>);<span class="keyword">throw</span> a.code=<span class="string">"MODULE_NOT_FOUND"</span>,a&#125;<span class="keyword">var</span> p=n[i]=&#123;<span class="attr">exports</span>:&#123;&#125;&#125;;e[i][<span class="number">0</span>].call(p.exports,<span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;<span class="keyword">var</span> n=e[i][<span class="number">1</span>][r];<span class="keyword">return</span> o(n||r)&#125;,p,p.exports,r,e,n,t)&#125;<span class="keyword">return</span> n[i].exports&#125;<span class="keyword">for</span>(<span class="keyword">var</span> u=<span class="string">"function"</span>==<span class="keyword">typeof</span> <span class="built_in">require</span>&amp;&amp;<span class="built_in">require</span>,i=<span class="number">0</span>;i&lt;t.length;i++)o(t[i]);<span class="keyword">return</span> o&#125;<span class="keyword">return</span> r&#125;)()(&#123;</span><br><span class="line">      <span class="number">1</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line"><span class="meta">          "use strict"</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// 为避免内容过长，此部分略去</span></span><br><span class="line"></span><br><span class="line">          <span class="built_in">module</span>.exports = unique</span><br><span class="line"></span><br><span class="line">      &#125;,&#123;&#125;],</span><br><span class="line">      <span class="number">2</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">const</span> nums = <span class="built_in">require</span>(<span class="string">'./nums'</span>)</span><br><span class="line">          <span class="built_in">console</span>.log(nums)</span><br><span class="line">      &#125;,&#123;<span class="string">"./nums"</span>:<span class="number">3</span>&#125;],</span><br><span class="line">      <span class="number">3</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">var</span> uniq = <span class="built_in">require</span>(<span class="string">'uniq'</span>);</span><br><span class="line">          <span class="keyword">var</span> nums = [ <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span> ];</span><br><span class="line"></span><br><span class="line">          <span class="built_in">module</span>.exports = nums</span><br><span class="line">      &#125;,&#123;<span class="string">"uniq"</span>:<span class="number">1</span>&#125;],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">    [<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>
<h4 id="build-后文件运转方式"><a href="#build-后文件运转方式" class="headerlink" title="build 后文件运转方式"></a>build 后文件运转方式</h4><p>上面的编译后文件，顶部的压缩代码，来源于 <a href="https://github.com/browserify/browser-pack/blob/e5ca7eb5053a4fc6c7b198e1ac831e7f9c3b44d6/prelude.js" target="_blank" rel="noopener"><code>browser-pack</code></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// modules are defined as an array</span></span><br><span class="line"><span class="comment">// [ module function, map of requireuires ]</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// map of requireuires is short require name -&gt; numeric require</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// anything defined in a previous bundle is accessed via the</span></span><br><span class="line"><span class="comment">// orig method which is the requireuire for previous bundles</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params">modules, cache, entry</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Save the require from previous bundle to this closure if any</span></span><br><span class="line">    <span class="keyword">var</span> previousRequire = <span class="keyword">typeof</span> <span class="built_in">require</span> == <span class="string">"function"</span> &amp;&amp; <span class="built_in">require</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">newRequire</span>(<span class="params">name, jumped</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!cache[name]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!modules[name]) &#123;</span><br><span class="line">                <span class="comment">// if we cannot find the module within our internal map or</span></span><br><span class="line">                <span class="comment">// cache jump to the current global require ie. the last bundle</span></span><br><span class="line">                <span class="comment">// that was added to the page.</span></span><br><span class="line">                <span class="keyword">var</span> currentRequire = <span class="keyword">typeof</span> <span class="built_in">require</span> == <span class="string">"function"</span> &amp;&amp; <span class="built_in">require</span>;</span><br><span class="line">                <span class="keyword">if</span> (!jumped &amp;&amp; currentRequire) <span class="keyword">return</span> currentRequire(name, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// If there are other bundles on this page the require from the</span></span><br><span class="line">                <span class="comment">// previous one is saved to 'previousRequire'. Repeat this as</span></span><br><span class="line">                <span class="comment">// many times as there are bundles until the module is found or</span></span><br><span class="line">                <span class="comment">// we exhaust the require chain.</span></span><br><span class="line">                <span class="keyword">if</span> (previousRequire) <span class="keyword">return</span> previousRequire(name, <span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">var</span> err = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Cannot find module \''</span> + name + <span class="string">'\''</span>);</span><br><span class="line">                err.code = <span class="string">'MODULE_NOT_FOUND'</span>;</span><br><span class="line">                <span class="keyword">throw</span> err;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> m = cache[name] = &#123;<span class="attr">exports</span>:&#123;&#125;&#125;;</span><br><span class="line">            modules[name][<span class="number">0</span>].call(m.exports, <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> id = modules[name][<span class="number">1</span>][x];</span><br><span class="line">                <span class="keyword">return</span> newRequire(id ? id : x);</span><br><span class="line">            &#125;,m,m.exports,outer,modules,cache,entry);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cache[name].exports;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;entry.length;i++) newRequire(entry[i]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Override the current require with this new one</span></span><br><span class="line">    <span class="keyword">return</span> newRequire;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> outer;</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>上方的编译代码，即相当于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step 1</span></span><br><span class="line">newRequire(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// step 2</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">const</span> nums = <span class="built_in">require</span>(<span class="string">'./nums'</span>)</span><br><span class="line">	<span class="built_in">console</span>.log(nums)</span><br><span class="line">&#125;).call(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">	<span class="comment">// name is 2</span></span><br><span class="line">	<span class="comment">// x is './nums'</span></span><br><span class="line">	<span class="comment">// id is 3</span></span><br><span class="line">    <span class="keyword">var</span> id = modules[name][<span class="number">1</span>][x];</span><br><span class="line">    <span class="keyword">return</span> newRequire(id ? id : x);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 至于说，为什么这里要增加 outer, modules, cache, entry 这样的无用参数</span></span><br><span class="line"><span class="comment">// 可参考：https://github.com/browserify/browser-pack/issues/82</span></span><br><span class="line"><span class="comment">// 简单理解为：有其他用途</span></span><br><span class="line">&#125;, &#123; <span class="attr">exports</span>:&#123;&#125; &#125;, &#123;&#125;, outer, modules, cache, entry)</span><br><span class="line"></span><br><span class="line"><span class="comment">// step 3, 4, 5, etc...</span></span><br></pre></td></tr></table></figure>
<p>以此类推，通过 <code>newRequire</code> 以及相应的 <code>modules</code> 编号，达到代码执行的目的。</p>
<h2 id="多入口文件编译"><a href="#多入口文件编译" class="headerlink" title="多入口文件编译"></a>多入口文件编译</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browserify = <span class="built_in">require</span>(<span class="string">'browserify'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定入口即可</span></span><br><span class="line">[<span class="string">'./src/demo-1'</span>, <span class="string">'./src/demo-2'</span>].forEach(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">  browserify(f).bundle().pipe(fs.createWriteStream(f.replace(<span class="string">'./src'</span>, <span class="string">'./build'</span>) + <span class="string">'.js'</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h4 id="entries"><a href="#entries" class="headerlink" title="entries"></a>entries</h4><p>同 browserify 第一个参数，files</p>
<h4 id="basedir"><a href="#basedir" class="headerlink" title="basedir"></a>basedir</h4><p>如果 <code>entries</code> / <code>files</code> 为 stream，需要指定 <code>basedir</code> 来让 browserify 可以处理内容中的相对路径</p>
<p>默认为 <code>.</code> 即当前脚本运行目录</p>
<h4 id="require"><a href="#require" class="headerlink" title="require"></a><del>require</del></h4><p>数组，通过模块名或文件路径指定需要打包到bundle中的其他模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">browserify(<span class="string">'demo-4'</span>, &#123;</span><br><span class="line">  basedir: <span class="string">'./src'</span>,</span><br><span class="line">  <span class="built_in">require</span>: [<span class="string">'./demo-3-module-2'</span>],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>适用于一些全局的处理，又没有模块依赖的内容</p>
<p>例如 <code>./demo-3-module-2</code> 内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.demo3Func = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过 参数 <code>opts.require</code> 方式引入，那么所有被打包的文件，都会有此部分代码</p>
<h4 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h4><p><code>debug</code> 为 <code>true</code> 时，会将 sourcemap 添加到包的末尾</p>
<h4 id="ignoreMissing"><a href="#ignoreMissing" class="headerlink" title="ignoreMissing"></a><del>ignoreMissing</del></h4><p>默认为 <code>false</code>，即如果 <code>require</code> 的模块不存在时，会报错；如果设置为<code>false</code>，即忽略报错</p>
<h4 id="noParse"><a href="#noParse" class="headerlink" title="noParse"></a>noParse</h4><p>一个数组，跳过数组中每个文件的所有 <code>require</code> 和全局解析</p>
<p>适用于jquery或threejs等巨型、无需解析的库，避免解析耗时过长</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  noParse: [<span class="string">'jquery'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h4><p>一个数组，用于内容的相应转换。例如使用 uglifyify</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">browserify(f, &#123;</span><br><span class="line">    transform: [<span class="string">'babelify'</span>], <span class="comment">// babel 配置在 .babelrc 中指定</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">browserify(f, &#123;</span><br><span class="line">    transform: [[<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;]],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>数组的元素可以为字符串，或者数组（该数组第一项为使用的transform组件，第二项为该组件配置项）。</p>
<p>下方 plugin 等，同理。</p>
<h4 id="ignoreTransform"><a href="#ignoreTransform" class="headerlink" title="ignoreTransform"></a><del>ignoreTransform</del></h4><p>一个数组，用于过滤不需要做 <code>transform</code> 的 transform 控件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">browserify(f, &#123;</span><br><span class="line">    transform: [[<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;]],</span><br><span class="line">    ignoreTransform: [<span class="string">'babelify'</span>],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>也就不会进行 <code>babelify</code> transform</p>
<p>这个参数没什么作用，其实如果不想进行转换，不把它放入 <code>transform</code> 内就好，不需要多此一举在 <code>transform</code> 中添加，又在 <code>ignoreTransform</code> 定义不进行转换</p>
<h4 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h4><p>插件数组。主要用于一些更高级的插件配置，增强 browserify 功能。</p>
<p>详见：<a href="https://github.com/browserify/browserify#plugins" target="_blank" rel="noopener">plugins</a> 或者下方一些示例</p>
<h4 id="extensions"><a href="#extensions" class="headerlink" title="extensions"></a>extensions</h4><p>参数可为字符串或数组。默认是 <code>[&#39;.js&#39;, &#39;.json&#39;]</code>，可以补充 <code>.ts</code>, <code>.jsx</code> 等等</p>
<h4 id="paths"><a href="#paths" class="headerlink" title="paths"></a>paths</h4><p>一个目录数组，用于在查找未使用相对路径引用的模块时浏览搜索，可以是绝对的或相对于basedir。调用browserify命令时，等效设置 <code>NODE_PATH</code> 环境变量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">browserify(<span class="string">'./src/demo'</span>, &#123;</span><br><span class="line">    basedir: <span class="string">'./'</span>,</span><br><span class="line">    transform: [[<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;]],</span><br><span class="line">    paths: [<span class="string">'src'</span>], <span class="comment">// ./src 下的模块引用都不需要使用相对路径引用</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">browserify(<span class="string">'./demo'</span>, &#123;</span><br><span class="line">    basedir: <span class="string">'./src'</span>,</span><br><span class="line">    transform: [[<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;]],</span><br><span class="line">    paths: [<span class="string">'test'</span>], <span class="comment">// ./src/test 下的模块引用都不需要使用相对路径引用</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>例如：原来 <code>require(&#39;./a&#39;)</code> 可以直接写为 <code>require(&#39;a&#39;)</code></p>
<h4 id="commondir"><a href="#commondir" class="headerlink" title="commondir"></a><del>commondir</del></h4><p>没什么作用的参数，要么不传递，要么传递 <code>false</code></p>
<p>目前看 <a href="https://github.com/browserify/browserify/blob/4190ed509f46a17b2071af2c58cea505e41f43b4/index.js#L616" target="_blank" rel="noopener">browserify index.js:616</a> 只会在 <code>builtIns</code> 为数组时，会将 <code>basedir</code> 设置为 <code>/</code></p>
<p>可能对 sourcemap 有一点影响，其他没什么作用</p>
<h4 id="fullPaths"><a href="#fullPaths" class="headerlink" title="fullPaths"></a><del>fullPaths</del></h4><p>布尔值，默认为 <code>false</code>，参考上方的分析代码，对应模块会被标记为数字 id，例如： <code>./nums: 0</code></p>
<p>如果设置为 true，不会转换为 id，而是以绝对路径形式展示。例如：<code>&quot;./nums&quot;:&quot;/Users/xxx/xxx/xxx/browserify-demo/src/nums.js&quot;</code>。官网文档描述其对于保留生成包的原始路径很有用，但是如果在生产环境下，需要设置为 <code>false</code>，否则可能会暴露一些信息</p>
<h4 id="standalone"><a href="#standalone" class="headerlink" title="standalone"></a><del>standalone</del></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// beep.js</span></span><br><span class="line"><span class="keyword">var</span> shout = <span class="built_in">require</span>(<span class="string">'./shout.js'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">beep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(shout(<span class="string">'beep'</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// shout.js </span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">shout</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.toUpperCase() + <span class="string">'!'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// build.js</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> browserify = <span class="built_in">require</span>(<span class="string">'browserify'</span>);</span><br><span class="line"><span class="keyword">var</span> b = browserify(<span class="string">'./src/beep.js'</span>, &#123; <span class="attr">standalone</span>: <span class="string">'beep-boop'</span> &#125;);</span><br><span class="line">b.bundle().pipe(fs.createWriteStream(<span class="string">'./build/demo-5.js'</span>));</span><br></pre></td></tr></table></figure>
<p>如果使用 <code>standalone: &#39;beep-boop&#39;</code> 最终打包出来的内容，就不是 <a href="https://github.com/browserify/browser-pack/blob/e5ca7eb5053a4fc6c7b198e1ac831e7f9c3b44d6/prelude.js" target="_blank" rel="noopener"><code>browser-pack</code></a> 做的包裹，而是</p>
<p>这个 <a href="https://github.com/ForbesLindesay/umd/blob/master/template.js" target="_blank" rel="noopener">umd/template</a> 做的包裹，主要用来处理 requireJS 类似的调用方式，包括在全局下增加 变量。例如上方最终在全局下增加的 <code>beepBoop</code>（驼峰） 变量。</p>
<p>所以作为 standalone（“独立”）的模块，就目前9012年来说，没有什么意义。</p>
<p>参考：<a href="https://www.forbeslindesay.co.uk/post/46324645400/standalone-browserify-builds" target="_blank" rel="noopener">Standalone Browserify Builds</a></p>
<h4 id="externalRequireName"><a href="#externalRequireName" class="headerlink" title="externalRequireName"></a><del>externalRequireName</del></h4><p>文档不全，没什么用途，不要使用。需要搭配 <code>prelude</code> 参数（文档未描述）。参见：</p>
<ol>
<li><a href="https://github.com/browserify/browserify/blob/master/test/multi_bundle_unique.js#L13" target="_blank" rel="noopener">test/multi_bundle_unique</a></li>
<li><a href="https://github.com/browserify/browserify/issues/972" target="_blank" rel="noopener">opts.externalRequireName does not work in standalone mode</a></li>
</ol>
<h4 id="browserField"><a href="#browserField" class="headerlink" title="browserField"></a><del>browserField</del></h4><p>如果在项目中 package.json 中配置 browser 字段</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"browser"</span>: &#123;</span><br><span class="line">    <span class="string">"ccc"</span>: <span class="string">"./src/ccc.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>在代码源文件中，<code>require(&#39;ccc&#39;)</code> 会自动被处理成 <code>require(&#39;./src/ccc.js&#39;)</code></p>
<p>功能和 paths 类似，但是其主要用来<strong>替换</strong>原有的模块，而不是 <code>alias</code> 作用</p>
<p>而优先级方面，<code>paths</code> 的设置更高。不过，在使用上需要尽量避免<code>paths</code> 和 <code>browserField</code> 设置相同模块的情况，以免造成一些歧义和不可控的现象</p>
<p>为 <code>false</code> 时，将忽略 package.json 中这个字段</p>
<h4 id="builtins"><a href="#builtins" class="headerlink" title="builtins"></a><del>builtins</del></h4><p>设置要使用的内置函数列表，默认情况下为 <a href="https://github.com/browserify/browserify/blob/master/lib/builtins.js" target="_blank" rel="noopener"><code>lib/builtins.js</code></a></p>
<p>可为 <code>false</code>、<code>array</code>、<code>object</code></p>
<p>如果设置为 false，不会进行任何 Node 相关内容的设置</p>
<p>如果设置为 <code>array</code>，可以设置为 <a href="https://github.com/browserify/browserify/blob/master/lib/builtins.js" target="_blank" rel="noopener"><code>lib/builtins.js</code></a> 对应的 key name，例如： <code>[&#39;assert&#39;, &#39;buffer&#39;]</code> 代表只将此两部分作为内置内容</p>
<p>如果设置为 <code>Object</code>，将直接替换掉默认的 <a href="https://github.com/browserify/browserify/blob/master/lib/builtins.js" target="_blank" rel="noopener"><code>lib/builtins.js</code></a>，而采用用户的配置</p>
<p>详见：<a href="https://github.com/browserify/browserify/blob/4190ed509f46a17b2071af2c58cea505e41f43b4/index.js#L534" target="_blank" rel="noopener">builtins 代码逻辑</a></p>
<h4 id="bare"><a href="#bare" class="headerlink" title="bare"></a><del>bare</del></h4><p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(__dirname)</span><br><span class="line"><span class="built_in">console</span>.log(process.env)</span><br></pre></td></tr></table></figure>
<p>默认为 <code>false</code>，会将 <code>__dirname</code>、<code>process.env</code> 设置为浏览器可运行的内容 （包含 <code>builtins</code> ）。<code>process.env</code> 会被设置为 <a href="https://github.com/defunctzombie/node-process/blob/master/browser.js" target="_blank" rel="noopener">node-process</a></p>
<p>设置为 <code>true</code> 时，同 <code>builtins = false, commondir = false</code>。创建一个不包含 Node builtins 的bundle，并且不设置除 <code>__dirname</code> 和 <code>__filename</code> 之外的全局 Node 变量。即 <code>process.env</code> 还是 <code>process.env</code>。而这样的处理，如果模块内有使用相关 Node 模块，浏览器端运行会直接报错</p>
<h4 id="node"><a href="#node" class="headerlink" title="node"></a><del>node</del></h4><p>默认为 <code>false</code></p>
<p>设置为 <code>true</code> 时，创建一个在 Node 中运行的bundle，不使用浏览器版本的依赖项。与传递 <code>{bare：true，browserField：false}</code> 相同。这个参数，一般也用不上，如果在 node 运行，也便不需要 browserify</p>
<h4 id="detectGlobals"><a href="#detectGlobals" class="headerlink" title="detectGlobals"></a><del>detectGlobals</del></h4><p>默认为 <code>true</code>，只在 <code>bare</code> 为 <code>false</code> 时作用。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(__dirname)</span><br><span class="line"><span class="built_in">console</span>.log(process.env)</span><br></pre></td></tr></table></figure>
<p>会进行模块扫描，上方 <code>__dirname</code> 和 <code>process.env</code> 的设置，是先通过检测，后设置，不设置其他多余内容。但是这样，检测的时间会长一些</p>
<p>如果将其设置为 <code>false</code>，类似 <code>bare</code> 设置为 <code>true</code>，不会进行  <code>__dirname</code> 和 <code>process.env</code> 的设置</p>
<h4 id="insertGlobals"><a href="#insertGlobals" class="headerlink" title="insertGlobals"></a><del>insertGlobals</del></h4><p>默认为 <code>false</code>，即不直接设置所有 Node 相关的内容，而是通过 <code>detectGlobals=true</code> 按需设置</p>
<p>如果设置为 <code>true</code>，会始终插入 Node 相关内容，而不做相应模块分析检测。提高了效率，但是打出来的包，内容也更大。但是<code>detectGlobals</code> 必须为 <code>true</code> 才能工作</p>
<p>其他一些作用的需要条件详见：<a href="https://github.com/browserify/browserify/blob/4190ed509f46a17b2071af2c58cea505e41f43b4/index.js#L572" target="_blank" rel="noopener">globalTr</a></p>
<h4 id="insertGlobalVars"><a href="#insertGlobalVars" class="headerlink" title="insertGlobalVars"></a><del>insertGlobalVars</del></h4><p>会被作为 <code>opts.vars</code> 传递给 <a href="https://github.com/browserify/insert-module-globals/blob/master/index.js" target="_blank" rel="noopener">insert-module-globals</a></p>
<p>格式可参考 <a href="https://github.com/browserify/insert-module-globals/blob/master/index.js#L27" target="_blank" rel="noopener">defaultVars</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  detectGlobals: <span class="literal">true</span>,</span><br><span class="line">  insertGlobalVars: &#123;</span><br><span class="line">    forTest: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'1111'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：<code>detectGlobals</code> 需要为 <code>true</code>，这样才能检测文件内的 forTest 变量，并做相应设置</p>
<h4 id="bundleExternal"><a href="#bundleExternal" class="headerlink" title="bundleExternal"></a><del>bundleExternal</del></h4><p>默认为 <code>true</code>，代表内置的 <code>process</code>、<code>buffer</code> 是否可以设置进去</p>
<p>详见：<a href="https://github.com/browserify/browserify/blob/4190ed509f46a17b2071af2c58cea505e41f43b4/index.js#L608" target="_blank" rel="noopener">index.js#L608</a></p>
<p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  detectGlobals: <span class="literal">true</span>,</span><br><span class="line">  insertGlobal: <span class="literal">true</span>,</span><br><span class="line">  bundleExternal: <span class="literal">false</span>,</span><br><span class="line">  insertGlobalVars: &#123;</span><br><span class="line">    xxx: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'1111'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即使 <code>detectGlobals</code>, <code>insertGlobal</code> 都为 <code>true</code>，也不会进行 <code>process</code> 和 <code>buffer</code> 的设置</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h4 id="b-add-file-opts"><a href="#b-add-file-opts" class="headerlink" title="b.add(file, opts)"></a>b.add(file, opts)</h4><p>同 <code>opts.entries</code> 参数</p>
<h4 id="b-require-file-opts"><a href="#b-require-file-opts" class="headerlink" title="b.require(file, opts)"></a>b.require(file, opts)</h4><p>同 <code>opts.require</code> 参数</p>
<h4 id="b-ignore-file-、b-external-file-、b-exclude-file"><a href="#b-ignore-file-、b-external-file-、b-exclude-file" class="headerlink" title="b.ignore(file)、b.external(file)、b.exclude(file)"></a><del>b.ignore(file)</del>、<del>b.external(file)</del>、<del>b.exclude(file)</del></h4><p>这三个方法，都是用来将 打包文件内的某个/某几个模块 移除编译内容，参数可为 <code>string</code>、<code>array</code></p>
<p>三个方法的区别，文档也没说清（browserify 文档太过简略）。大概如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>)</span><br><span class="line">$(<span class="string">'body'</span>).css(<span class="string">'background'</span>, <span class="string">'red'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ignore</span></span><br><span class="line">(&#123;</span><br><span class="line">  <span class="number">1</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line">  &#125;,&#123;&#125;],</span><br><span class="line">  <span class="number">2</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>)</span><br><span class="line">    $(<span class="string">'body'</span>).css(<span class="string">'background'</span>, <span class="string">'red'</span>)</span><br><span class="line">  &#125;,&#123;<span class="string">"jquery"</span>:<span class="number">1</span>&#125;],</span><br><span class="line">&#125;, &#123;&#125;,[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// exclude</span></span><br><span class="line">(&#123;</span><br><span class="line">  <span class="number">1</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>)</span><br><span class="line">  $(<span class="string">'body'</span>).css(<span class="string">'background'</span>, <span class="string">'red'</span>)</span><br><span class="line">  &#125;,&#123;<span class="string">"jquery"</span>:<span class="literal">undefined</span>&#125;]</span><br><span class="line">&#125;, &#123;&#125;,[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// external</span></span><br><span class="line">(&#123;</span><br><span class="line">  <span class="number">1</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>)</span><br><span class="line">  $(<span class="string">'body'</span>).css(<span class="string">'background'</span>, <span class="string">'red'</span>)</span><br><span class="line">  &#125;,&#123;<span class="string">"jquery"</span>:<span class="string">"jquery"</span>&#125;]</span><br><span class="line">&#125;,&#123;&#125;,[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<p>理解大概是：</p>
<ol>
<li><code>ignore</code> 代表忽略，如果内部引用了，会将其模块作为作为空模块处理，模块的位置还在</li>
<li><code>exclude</code> 会将该模块直接移除，并且如果 <code>require</code>了的话，值为 <code>undefined</code></li>
<li><code>external</code> 会将该模块移除，但是对应的模块引入，还是会在运行时进行 <code>require(name)</code> 的形式，由全局的 require 进行其他模块依赖引入</li>
</ol>
<p>这么看，也只有 <code>external</code> 具备一定的实用性</p>
<h4 id="b-transform-tr-opts"><a href="#b-transform-tr-opts" class="headerlink" title="b.transform(tr, opts={})"></a>b.transform(tr, opts={})</h4><p>同 <code>opts.transform</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">b.transform(<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同</span></span><br><span class="line">browserify(<span class="string">'./src/demo'</span>, &#123;</span><br><span class="line">  transform: [[<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;]],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="b-plugin-plugin-opts"><a href="#b-plugin-plugin-opts" class="headerlink" title="b.plugin(plugin, opts)"></a>b.plugin(plugin, opts)</h4><p>同 <code>opts.plugin</code></p>
<h4 id="b-bundle-cb"><a href="#b-bundle-cb" class="headerlink" title="b.bundle(cb)"></a>b.bundle(cb)</h4><p>将内容以及内容内部的 <code>reuqire</code> 内容，一并打包进一个文件内</p>
<p>创建了一个可读流，用于 pipe 进可写流文件。例如：</p>
<p><code>b.bundle().pipe(fs.createWriteStream(&#39;./build/demo-7.js&#39;))</code></p>
<p><code>callback</code> 为可选项，参数为 <code>err, buf</code>，<code>buf</code> 为文件 <code>buffer</code> 内容，因此也就可以基于 <code>buf</code> 内容进行一些其他处理</p>
<h4 id="b-pipeline"><a href="#b-pipeline" class="headerlink" title="b.pipeline"></a><del>b.pipeline</del></h4><p>一个属性，使用 <a href="https://github.com/browserify/labeled-stream-splicer" target="_blank" rel="noopener">labeled-stream-splicer</a>，个人简单理解为将内容拆分为不同的分段，通过流的方式进行传递</p>
<p>一般来讲，如果不是写插件之类东西，单纯使用 browserify 层面上来说，用不到</p>
<p>对应的，browserify 内置了一些 label</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'record'</span> - save inputs to play back later on subsequent bundle() calls</span><br><span class="line"><span class="string">'deps'</span> - <span class="built_in">module</span>-deps</span><br><span class="line"><span class="string">'json'</span> - adds <span class="built_in">module</span>.exports= to the beginning <span class="keyword">of</span> json files</span><br><span class="line"><span class="string">'unbom'</span> - remove byte-order markers</span><br><span class="line"><span class="string">'unshebang'</span> - remove #! labels on the first line</span><br><span class="line"><span class="string">'syntax'</span> - check <span class="keyword">for</span> syntax errors</span><br><span class="line"><span class="string">'sort'</span> - sort the dependencies <span class="keyword">for</span> deterministic bundles</span><br><span class="line"><span class="string">'dedupe'</span> - remove duplicate source contents</span><br><span class="line"><span class="string">'label'</span> - apply integer labels to files</span><br><span class="line"><span class="string">'emit-deps'</span> - emit <span class="string">'dep'</span> event</span><br><span class="line"><span class="string">'debug'</span> - apply source maps</span><br><span class="line"><span class="string">'pack'</span> - browser-pack</span><br><span class="line"><span class="string">'wrap'</span> - apply final wrapping, <span class="built_in">require</span>= and a newline and semicolon</span><br></pre></td></tr></table></figure>
<p>可以通过 <code>b.pipeline.get(label)</code> 的方式获取，并对其进行相应的处理</p>
<h4 id="b-reset-opts"><a href="#b-reset-opts" class="headerlink" title="b.reset(opts)"></a><del>b.reset(opts)</del></h4><p>将流恢复到 <code>bundle()</code> 前的状态，主要用于需要多次 <code>bundle()</code> 的场景</p>
<p>实际每次 <code>bundle()</code> 调用后，<code>reset()</code> 都会自动执行，所以这个方法在实际使用过程中，可能也没有太大的用处</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = browserify(<span class="string">'./src/beep.js'</span>, &#123;</span><br><span class="line">  debug: <span class="literal">true</span>,</span><br><span class="line">  commondir: <span class="literal">false</span>,</span><br><span class="line">  builtins: [],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">b</span><br><span class="line">.transform(<span class="string">'uglifyify'</span>, &#123; <span class="attr">global</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">.bundle().pipe(fs.createWriteStream(<span class="string">'./build/demo-6.js'</span>));</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  b.bundle().pipe(fs.createWriteStream(<span class="string">'./build/demo-7.js'</span>));</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<p>上方 打包出来 demo-6、demo-7 内容是完全一致的</p>
<p>或者参考 <a href="https://github.com/browserify/browserify/blob/4190ed509f46a17b2071af2c58cea505e41f43b4/test/reset.js" target="_blank" rel="noopener">browserify/test/reset.js</a></p>
<h2 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a><del>其他工具</del></h2><p>更多的工具，可见 <a href="https://github.com/browserify/awesome-browserify#tools" target="_blank" rel="noopener">awesome-browserify#tools</a>，此处取一部分代表性内容</p>
<h4 id="budo"><a href="#budo" class="headerlink" title="budo"></a>budo</h4><p>启动 http 服务器，进行相应 browserify 打包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">budo ./beep.js --live --open</span><br></pre></td></tr></table></figure>
<p>如果 index.html 内，引用 <code>&lt;script src=&quot;./beep.js&quot;&gt;&lt;/script&gt;</code>，最终启动的服务便是这个 index.html，以及实时打包的 <code>http://127.0.0.1:9966/beep.js</code> 文件</p>
<p>内容类似如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/budo/livereload.js"</span> <span class="attr">async</span>=<span class="string">""</span> <span class="attr">defer</span>=<span class="string">""</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"beep.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="envify"><a href="#envify" class="headerlink" title="envify"></a>envify</h4><p>给 <code>process.env</code> 添加环境变量替换</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">b.transform(envify(&#123;</span><br><span class="line">  <span class="comment">// 将 process.env 其他字段设置为 undefined</span></span><br><span class="line">  _: <span class="string">'purge'</span>,</span><br><span class="line">  <span class="comment">// process.env.NODE_ENV 会被自动替换为 'development'，而不是在运行时获取 process.env.NODE_ENV 值</span></span><br><span class="line">  NODE_ENV: <span class="string">'development'</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<h4 id="babelify"><a href="#babelify" class="headerlink" title="babelify"></a>babelify</h4><p>因为 browserify 只处理文件相关依赖引入，不处理文件的 es6 转换，因此如果需要使用 es6、es7 语法，需要经过 babelify 进行转换</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'./src/demo-1'</span>, <span class="string">'./src/demo-2'</span>].forEach(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">  browserify(f)</span><br><span class="line">    .transform(<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;)</span><br><span class="line">    .bundle()</span><br><span class="line">    .pipe(fs.createWriteStream(f.replace(<span class="string">'./src'</span>, <span class="string">'./build'</span>) + <span class="string">'.js'</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="tsify"><a href="#tsify" class="headerlink" title="tsify"></a><del>tsify</del></h4><p>因为 browserify 只处理文件相关依赖引入，如果想要使用 typescript 编写浏览器端代码，需要进行相应转换</p>
<p>但是原则上，其实也可以通过 gulp-babel 的方式进行处理，因为：</p>
<ol>
<li>babel 7 支持了 typescript 的转换</li>
<li>gulp-babel 也是基于流</li>
</ol>
<p>或者，通过 gulp-typescript 进行处理，理由同上</p>
<h4 id="uglifyify"><a href="#uglifyify" class="headerlink" title="uglifyify"></a>uglifyify</h4><p>代码丑化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'./src/demo-1'</span>, <span class="string">'./src/demo-2'</span>].forEach(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">  browserify(f)</span><br><span class="line">    .transform(<span class="string">'uglifyify'</span>, &#123; <span class="attr">global</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .bundle()</span><br><span class="line">    .pipe(fs.createWriteStream(f.replace(<span class="string">'./src'</span>, <span class="string">'./build'</span>) + <span class="string">'.js'</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="tinyify"><a href="#tinyify" class="headerlink" title="tinyify"></a><del>tinyify</del></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b.plugin(<span class="string">'tinyify'</span>, &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    PUBLIC_PATH: <span class="string">'https://mywebsite.surge.sh/'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>以下用到的插件的整合版本<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">b</span><br><span class="line">    .transform(<span class="string">'unassertify'</span>, &#123; <span class="attr">global</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .transform(<span class="string">'envify'</span>, &#123; <span class="attr">global</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .transform(<span class="string">'uglifyify'</span>, &#123; <span class="attr">global</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .plugin(<span class="string">'common-shakeify'</span>)</span><br><span class="line">    .plugin(<span class="string">'browser-pack-flat/plugin'</span>)</span><br><span class="line">    .bundle()</span><br><span class="line">    .pipe(<span class="built_in">require</span>(<span class="string">'minify-stream'</span>)(&#123; <span class="attr">sourceMap</span>: <span class="literal">false</span> &#125;))</span><br><span class="line">    .pipe(fs.createWriteStream(<span class="string">'./output.js'</span>))</span><br></pre></td></tr></table></figure></p>
<h4 id="watchify"><a href="#watchify" class="headerlink" title="watchify"></a>watchify</h4><p>检测改动，自动编译</p>
<p>作为插件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> b = browserify(<span class="string">'./demo-2'</span>, &#123;</span><br><span class="line">  basedir: <span class="string">'src'</span>,</span><br><span class="line">  debug: <span class="literal">true</span>,</span><br><span class="line">  paths: [<span class="string">'./'</span>],</span><br><span class="line">  fullPaths: <span class="literal">true</span>,</span><br><span class="line">  plugin: [[<span class="string">'watchify'</span>, &#123;</span><br><span class="line">    delay: <span class="number">100</span>,</span><br><span class="line">    ignoreWatch: [<span class="string">'**/node_modules/**'</span>],</span><br><span class="line">    poll: <span class="literal">false</span></span><br><span class="line">  &#125;]]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">b.on(<span class="string">'update'</span>, bundle)</span><br><span class="line">bundle()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bundle</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x)</span><br><span class="line">  b</span><br><span class="line">    .transform(<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;)</span><br><span class="line">    .transform(<span class="string">'uglifyify'</span>, &#123; <span class="attr">global</span>: <span class="literal">true</span>, <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .bundle()</span><br><span class="line">    .on(<span class="string">'error'</span>, <span class="built_in">console</span>.error)</span><br><span class="line">    .pipe(fs.createWriteStream(<span class="string">'./build/demo-5.js'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> b = watchify(browserify(<span class="string">'./demo-2'</span>, &#123;</span><br><span class="line">  basedir: <span class="string">'src'</span>,</span><br><span class="line">  debug: <span class="literal">true</span>,</span><br><span class="line">  paths: [<span class="string">'./'</span>],</span><br><span class="line">  fullPaths: <span class="literal">true</span>,</span><br><span class="line">&#125;), &#123;</span><br><span class="line">  delay: <span class="number">100</span>,</span><br><span class="line">  ignoreWatch: [<span class="string">'**/node_modules/**'</span>],</span><br><span class="line">  poll: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">b.on(<span class="string">'update'</span>, bundle)</span><br><span class="line">bundle()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bundle</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x)</span><br><span class="line">  b</span><br><span class="line">  .transform(<span class="string">'babelify'</span>, &#123; <span class="attr">presets</span>: [<span class="string">'@babel/preset-env'</span>] &#125;)</span><br><span class="line">  .transform(<span class="string">'uglifyify'</span>, &#123; <span class="attr">global</span>: <span class="literal">true</span>, <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  .bundle()</span><br><span class="line">  .on(<span class="string">'error'</span>, <span class="built_in">console</span>.error)</span><br><span class="line">  .pipe(fs.createWriteStream(<span class="string">'./build/demo-5.js'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>附：<a href="https://github.com/gulpjs/gulp/blob/master/docs/recipes/fast-browserify-builds-with-watchify.md" target="_blank" rel="noopener">Fast browserify builds with watchify</a></p>
<h4 id="css-modulesify"><a href="#css-modulesify" class="headerlink" title="css-modulesify"></a>css-modulesify</h4><p>如其名 <a href="https://github.com/css-modules/css-modulesify" target="_blank" rel="noopener">css-modulesify</a>，使用它可以在 js 中 <code>require</code> css 内容</p>
<h4 id="brfs"><a href="#brfs" class="headerlink" title="brfs"></a>brfs</h4><p>使用 <a href="https://github.com/browserify/brfs" target="_blank" rel="noopener">brfs</a>，可以达到 js 中 <code>require</code> html 类似的效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = fs.readFileSync(__dirname + <span class="string">'/robot.html'</span>, <span class="string">'utf8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最终转换为</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> html = <span class="string">"&lt;b&gt;beep boop&lt;/b&gt;\n"</span>;</span><br></pre></td></tr></table></figure>
<h4 id="browserify-hmr"><a href="#browserify-hmr" class="headerlink" title="browserify-hmr"></a><del>browserify-hmr</del></h4><p>browserify 本身是基于流，效率比较高。热更新的用处不大，而且根据 <a href="https://github.com/Macil/browserify-hmr#browserify-hmr" target="_blank" rel="noopener">README.md</a> 内作者描述，此插件还是存在不少问题</p>
<h4 id="factor-bundle"><a href="#factor-bundle" class="headerlink" title="factor-bundle"></a>factor-bundle</h4><p>拆包：将 x、y 共用部分，打包进 <code>common.js</code>，有一定的实用性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">browserify([ <span class="string">'./files/x.js'</span>, <span class="string">'./files/y.js'</span> ])</span><br><span class="line">  .plugin(<span class="string">'factor-bundle'</span>, &#123; <span class="attr">outputs</span>: [ <span class="string">'bundle/x.js'</span>, <span class="string">'bundle/y.js'</span> ] &#125;)</span><br><span class="line">  .bundle().pipe(fs.createWriteStream(<span class="string">'bundle/common.js'</span>))</span><br></pre></td></tr></table></figure>
<h2 id="和-gulp-对比"><a href="#和-gulp-对比" class="headerlink" title="和 gulp 对比"></a>和 gulp 对比</h2><h4 id="gulp-缺陷"><a href="#gulp-缺陷" class="headerlink" title="gulp 缺陷"></a>gulp 缺陷</h4><ol>
<li>gulp 没有相关 <code>require</code> 引用处理的能力</li>
<li><p>如果单纯只用 gulp，相应模块之间的拆分，只能通过全局变量的方式进行管理，相对来说比较混乱。例如：</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a module</span></span><br><span class="line"><span class="built_in">window</span>.lib.someFunc = xxx</span><br><span class="line"></span><br><span class="line"><span class="comment">// b module</span></span><br><span class="line"><span class="built_in">window</span>.lib.someFunc()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打包</span></span><br><span class="line">gulp.src([<span class="string">'a.js'</span>, <span class="string">'b.js'</span>])</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="browserify-优势与缺陷"><a href="#browserify-优势与缺陷" class="headerlink" title="browserify 优势与缺陷"></a>browserify 优势与缺陷</h4><h5 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h5><ol>
<li><p>而如果用 browserify，因为模块之间的引用，通过 <code>require</code> 完成。与 node 模块编写方式一致，此外，入口文件只需要一个。</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// a module</span></span><br><span class="line">exports.someFunc = xxx</span><br><span class="line"></span><br><span class="line"><span class="comment">// b module</span></span><br><span class="line"><span class="keyword">const</span> &#123; someFunc &#125; = <span class="built_in">require</span>(<span class="string">'./a'</span>)</span><br><span class="line">someFunc()</span><br><span class="line"></span><br><span class="line">browserify([<span class="string">'./b'</span>])</span><br><span class="line">  .bundle()</span><br><span class="line">  .pipe(fs.createWriteStream(<span class="string">'./build/b.js'</span>))</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h5><ol>
<li>以 <code>js</code> 作为入口文件，缺乏 <code>css</code>、<code>html</code> 等处理能力</li>
</ol>
<h4 id="一起使用"><a href="#一起使用" class="headerlink" title="一起使用"></a>一起使用</h4><p>而因为他们都是基于流的处理，因此可以通过流相关的工具，例如 <code>vinyl-source-stream</code>、<code>through2</code> 进行相应转换，来达到共用的目的</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>基于其与 gulp 的比较，个人认为 <strong>最好的方式</strong> 是在 gulp 中集成 browserify 功能（将 browserify 作为 gulp 的一个扩展），只用于 <code>require</code> 相关处理</p>
<p>这样，可以结合双方的优点，并且避免了双方的缺陷</p>
<p>而像 babel、typescript 相关转换以及 sourcemap、minify 等等功能，交给 gulp 相关插件</p>
<p>gulp 对应的 browserify 插件：<a href="https://github.com/ngryman/gulp-bro" target="_blank" rel="noopener"><code>gulp-bro</code></a></p>
<p>代码也比较简单，仅仅是对于流进行了相应转换 <a href="https://github.com/ngryman/gulp-bro/blob/master/index.js" target="_blank" rel="noopener">gulp-bro 源码</a></p>
<p>最后，此文对 browserify 做的部分介绍，相关配置、插件其实已经过时而没有太大存在和深究的意义</p>
<p>此外，</p>
<ol>
<li>browserify 的配置很多，而且很多都重复功能</li>
<li>browserify 基本上也只有浏览器前端才会需要使用，也就没必要用到太多的无用配置。例如：<code>bare, builtins, detectGlobals, insertGlobals, insertGlobalVars</code> 等等配置都应该移除</li>
<li>原 <code>gulp-browserify</code> 已经停止维护，像其他的一些 browserify 工具，也都很少再有更新</li>
</ol>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/前端工程化/" rel="tag">#前端工程化</a>
          
            <a href="/tags/browserify/" rel="tag">#browserify</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/15/webpack-文档与配置/" rel="prev">webpack 文档与配置</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/22/react-native-auto-fade-images/" rel="next">react-native-auto-fade-images</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              </div>
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://avatars2.githubusercontent.com/u/6246962?v=3&s=460" alt="Xaber" itemprop="image">
          <p class="site-author-name" itemprop="name">Xaber</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">75</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">18</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">86</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#大概介绍"><span class="nav-number">1.</span> <span class="nav-text">大概介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#大概分析"><span class="nav-number">2.</span> <span class="nav-text">大概分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#nums-js"><span class="nav-number">2.0.1.</span> <span class="nav-text">nums.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#demo-js"><span class="nav-number">2.0.2.</span> <span class="nav-text">demo.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#build"><span class="nav-number">2.0.3.</span> <span class="nav-text">build</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#build-后文件"><span class="nav-number">2.0.4.</span> <span class="nav-text">build 后文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#build-后文件运转方式"><span class="nav-number">2.0.5.</span> <span class="nav-text">build 后文件运转方式</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#多入口文件编译"><span class="nav-number">3.</span> <span class="nav-text">多入口文件编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置"><span class="nav-number">4.</span> <span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#entries"><span class="nav-number">4.0.1.</span> <span class="nav-text">entries</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#basedir"><span class="nav-number">4.0.2.</span> <span class="nav-text">basedir</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#require"><span class="nav-number">4.0.3.</span> <span class="nav-text">require</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#debug"><span class="nav-number">4.0.4.</span> <span class="nav-text">debug</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ignoreMissing"><span class="nav-number">4.0.5.</span> <span class="nav-text">ignoreMissing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#noParse"><span class="nav-number">4.0.6.</span> <span class="nav-text">noParse</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#transform"><span class="nav-number">4.0.7.</span> <span class="nav-text">transform</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ignoreTransform"><span class="nav-number">4.0.8.</span> <span class="nav-text">ignoreTransform</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#plugin"><span class="nav-number">4.0.9.</span> <span class="nav-text">plugin</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#extensions"><span class="nav-number">4.0.10.</span> <span class="nav-text">extensions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#paths"><span class="nav-number">4.0.11.</span> <span class="nav-text">paths</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#commondir"><span class="nav-number">4.0.12.</span> <span class="nav-text">commondir</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fullPaths"><span class="nav-number">4.0.13.</span> <span class="nav-text">fullPaths</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#standalone"><span class="nav-number">4.0.14.</span> <span class="nav-text">standalone</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#externalRequireName"><span class="nav-number">4.0.15.</span> <span class="nav-text">externalRequireName</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#browserField"><span class="nav-number">4.0.16.</span> <span class="nav-text">browserField</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#builtins"><span class="nav-number">4.0.17.</span> <span class="nav-text">builtins</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bare"><span class="nav-number">4.0.18.</span> <span class="nav-text">bare</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#node"><span class="nav-number">4.0.19.</span> <span class="nav-text">node</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#detectGlobals"><span class="nav-number">4.0.20.</span> <span class="nav-text">detectGlobals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#insertGlobals"><span class="nav-number">4.0.21.</span> <span class="nav-text">insertGlobals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#insertGlobalVars"><span class="nav-number">4.0.22.</span> <span class="nav-text">insertGlobalVars</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bundleExternal"><span class="nav-number">4.0.23.</span> <span class="nav-text">bundleExternal</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法"><span class="nav-number">5.</span> <span class="nav-text">方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#b-add-file-opts"><span class="nav-number">5.0.1.</span> <span class="nav-text">b.add(file, opts)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-require-file-opts"><span class="nav-number">5.0.2.</span> <span class="nav-text">b.require(file, opts)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-ignore-file-、b-external-file-、b-exclude-file"><span class="nav-number">5.0.3.</span> <span class="nav-text">b.ignore(file)、b.external(file)、b.exclude(file)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-transform-tr-opts"><span class="nav-number">5.0.4.</span> <span class="nav-text">b.transform(tr, opts={})</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-plugin-plugin-opts"><span class="nav-number">5.0.5.</span> <span class="nav-text">b.plugin(plugin, opts)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-bundle-cb"><span class="nav-number">5.0.6.</span> <span class="nav-text">b.bundle(cb)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-pipeline"><span class="nav-number">5.0.7.</span> <span class="nav-text">b.pipeline</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-reset-opts"><span class="nav-number">5.0.8.</span> <span class="nav-text">b.reset(opts)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他工具"><span class="nav-number">6.</span> <span class="nav-text">其他工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#budo"><span class="nav-number">6.0.1.</span> <span class="nav-text">budo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#envify"><span class="nav-number">6.0.2.</span> <span class="nav-text">envify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#babelify"><span class="nav-number">6.0.3.</span> <span class="nav-text">babelify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tsify"><span class="nav-number">6.0.4.</span> <span class="nav-text">tsify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#uglifyify"><span class="nav-number">6.0.5.</span> <span class="nav-text">uglifyify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tinyify"><span class="nav-number">6.0.6.</span> <span class="nav-text">tinyify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#watchify"><span class="nav-number">6.0.7.</span> <span class="nav-text">watchify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#css-modulesify"><span class="nav-number">6.0.8.</span> <span class="nav-text">css-modulesify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#brfs"><span class="nav-number">6.0.9.</span> <span class="nav-text">brfs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#browserify-hmr"><span class="nav-number">6.0.10.</span> <span class="nav-text">browserify-hmr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#factor-bundle"><span class="nav-number">6.0.11.</span> <span class="nav-text">factor-bundle</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#和-gulp-对比"><span class="nav-number">7.</span> <span class="nav-text">和 gulp 对比</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#gulp-缺陷"><span class="nav-number">7.0.1.</span> <span class="nav-text">gulp 缺陷</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#browserify-优势与缺陷"><span class="nav-number">7.0.2.</span> <span class="nav-text">browserify 优势与缺陷</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#优势"><span class="nav-number">7.0.2.1.</span> <span class="nav-text">优势</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#缺陷"><span class="nav-number">7.0.2.2.</span> <span class="nav-text">缺陷</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一起使用"><span class="nav-number">7.0.3.</span> <span class="nav-text">一起使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结语"><span class="nav-number">8.</span> <span class="nav-text">结语</span></a></li></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright">
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xaber</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'xaber';
      var disqus_identifier = '2019/08/01/browserify/';
      var disqus_title = 'browserify 中文文档与使用教程';
      var disqus_url = 'http://xaber.co/2019/08/01/browserify/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });

  </script>

  
  <script src="/js/fingerprint2.js"></script>
<script>
    $(function () {
        if (!window.zhuge || !window.Fingerprint2) {
            return;
        }

        var tb = function (num) {
            return num < 10 ? ('0' + num) : num;
        };

        var getFormatTime = function () {
            var a = new Date();
            return a.getFullYear() + '-' + 
                tb(a.getMonth() + 1) + '-' + 
                tb(a.getDate()) + ' ' +
                tb(a.getHours()) + ':' +
                tb(a.getMinutes()) + ':' +
                tb(a.getSeconds());
        };

        new Fingerprint2().get(function (result, components) {
            //a hash, representing your device fingerprint
            // console.log(result); 

            // an array of FP components
            // console.log(components);

            // 已设备指纹作为一个用户记录
            zhuge.identify(result, {});

            zhuge.track('页面展示', {
                'time': getFormatTime(),
                'referrer_url': document.referrer,
                'url': window.location.href
            });
        });
    });
</script>
</body>
</html>
